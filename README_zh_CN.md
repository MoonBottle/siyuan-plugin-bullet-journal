# 子弹笔记

[English](./README.md)

思源笔记子弹笔记风格的工作管理插件，提供日历视图、甘特图和项目列表功能，帮助您可视化管理工作任务。

## 功能特性

| 功能 | 描述 | 适用场景 |
|------|------|----------|
| **日历视图** | 以日历形式展示工作任务，支持月/周/日/列表视图 | 日/周计划和时间安排 |
| **甘特图** | 项目进度可视化，支持层级任务展示 | 了解项目时间线和任务依赖关系 |
| **项目列表** | 按项目分组展示任务，支持展开查看详情 | 组织和回顾所有项目任务 |
| **待办 Dock** | 在侧边栏显示即将到来的待办事项 | 快速查看今日及未来的待办 |

**核心差异化特性：**
- 📅 **记录驱动** - 专注于记录已完成和待完成的事项，而非提醒
- 🔗 **双向链接** - 点击任意任务可直接跳转到笔记中的对应位置
- 🎯 **无侵入式** - 使用标准 Markdown 格式，无专有格式锁定
- ⚡ **实时同步** - 笔记中的修改会自动同步到所有视图

![插件预览图](./preview.png)
<!-- 配图占位：请将插件运行后的截图替换到此处 -->

## 设计思想

### 与传统待办工具的区别

本插件的设计理念与传统待办工具（如滴答清单、Todoist）有本质不同，更接近**子弹笔记（Bullet Journal）**的思路：

| 传统待办工具 | 子弹笔记思路（本插件） |
|-------------|----------------------|
| 强调提醒和定时 | 强调记录和回顾 |
| 支持重复任务 | **不支持重复任务** |
| 任务可以跨越多天 | **事项不跨天** |
| 提前规划大量未来任务 | **聚焦今日及未来的待办** |
| 提醒驱动 | 记录驱动 |

**核心定位**：

- **记录 > 提醒**：不是为了推送提醒，而是记录你今日及未来要完成或已完成的事
- **分散书写，集中查看**：把分散在各处的想法统一记录，通过日历/甘特图/项目列表集中回顾
- **视图即回顾**：日历看今日事项，甘特图看进度，项目看归类，视图是梳理工具而非提醒工具
- **事项不跨天**：今日事今日毕

### 1. 无侵入式设计

本插件采用**无侵入式设计**，不修改用户的笔记内容，而是通过解析现有的 Markdown 格式来提取任务信息。这意味着：

- 您的笔记仍然是纯 Markdown 文件，可以在其他编辑器中正常阅读
- 不需要学习新的语法，仅使用标准的 Markdown 标记
- 数据完全存储在思源笔记中，无需额外的数据库

### 2. 块级双向链接

利用思源笔记的 Kramdown 格式，插件可以获取每个段落的唯一 `blockId`，实现：

- 点击日历/甘特图中的任务 → 跳转到对应的文档位置
- 在文档中修改任务内容 → 自动同步到各个视图
- 每个任务都有唯一的持久化链接

### 3. 配置驱动的目录扫描

插件不限定特定目录，而是通过配置让您指定要扫描的路径：

- 支持扫描多个目录
- 每个目录可以分配到不同的分组
- 自动扫描所有笔记本中匹配的文档

### 4. 多视图联动

同一个数据源，多种可视化方式：

| 视图 | 适用场景 |
|------|----------|
| 日历 | 查看每日/每周的工作安排 |
| 甘特图 | 了解项目整体进度和任务依赖 |
| 项目列表 | 按项目组织，查看所有任务 |
| 待办 Dock | 快速查看即将到来的事项 |

## 快速开始

### 第一步：安装插件

选择以下任一方式安装：

**方式 A：从集市安装（推荐）**
1. 打开思源设置 → 插件 → 集市
2. 搜索「子弹笔记」
3. 点击安装

**方式 B：手动安装**
1. 从 [GitHub Releases](https://github.com/MoonBottle/siyuan-plugin-bullet-journal/releases) 下载最新的 `package.zip`
2. 解压到思源数据目录：`data/plugins/siyuan-plugin-bullet-journal`
3. 重启思源笔记，在设置 → 插件中启用插件

> 💡 **提示**：安装完成后，顶栏工具栏会出现日历、甘特图和项目列表的新图标。

### 第二步：创建项目文档

在思源笔记中创建文档来记录项目任务。插件会扫描指定目录中的项目文件。

**推荐的目录结构：**

```
工作安排/
└── 2026/
    └── 项目/
        ├── 项目A.sy.md
        ├── 项目B.sy.md
        └── 项目C.sy.md
```

> ⚠️ **注意**：您可以使用任何喜欢的目录结构，插件通过路径模式来查找项目文件。

### 第三步：编写任务格式

插件通过解析 Markdown 内容来识别任务。项目文档包含三个区域：

```markdown
## 项目名称
> 项目描述
[项目链接](https://project.url)

### 工作任务
任务名称 #任务 @L1
[任务链接](https://task-link)
工作事项 @2024-01-01 10:00:00~11:00:00
另一个事项 @2024-01-02

子任务名称 #任务 @L2
子任务事项 @2024-01-03
```

**关键标记说明：**
- `#任务` - 标记该行为任务
- `@L1`、`@L2`、`@L3` - 任务层级（L1 = 父任务，L2/L3 = 子任务）
- `@YYYY-MM-DD` - 工作事项的日期标记
- `@YYYY-MM-DD HH:mm~HH:mm` - 带时间范围的日期

> 💡 **提示**：任务本身不带日期，日期是分配给任务下的工作事项的。这样可以让一个任务跨越多天，每天有不同的工作事项。

### 第四步：配置插件

1. 打开思源设置 → 插件 → 子弹笔记
2. 在「目录配置」中添加要扫描的路径（如 `工作安排/2026/项目`）
3. 可选：在「分组管理」中创建分组来组织项目
4. 保存设置 - 插件会自动扫描项目文件

> ⚠️ **常见问题**：如果数据没有显示，请检查：
> - 目录路径是否与实际文件夹结构匹配
> - 项目文档是否包含 `#任务` 标记
> - 工作事项是否有有效的日期格式（`@YYYY-MM-DD`）

### 第五步：查看与管理

配置完成后，通过多个视图访问您的任务：

| 视图 | 访问方式 | 适用场景 |
|------|----------|----------|
| **日历** | 点击顶栏 📅 日历图标 | 日/周计划概览 |
| **甘特图** | 点击顶栏 📊 甘特图图标 | 项目时间线可视化 |
| **项目列表** | 点击顶栏 📁 文件夹图标 | 按项目查看所有任务 |
| **待办 Dock** | 右键顶栏 → 关闭的面板 → 待办事项 | 快速访问即将到来的任务 |

> 💡 **专业提示**：点击日历或甘特图中的任意任务，可直接跳转到笔记中该任务的位置。

## 详细用法

### 数据格式区域

文档分为三个主要区域，每个区域解析不同类型的信息：

#### 1. 项目信息区（文档顶部）
位置：任务列表之前的内容

| 元素 | 格式 | 说明 |
|------|------|------|
| 项目名称 | `## 项目名称` | 文档标题 |
| 项目描述 | `> 项目描述` | 项目简述 |
| 项目链接 | `[链接名称](URL)` | 支持多个链接 |

#### 2. 任务区
位置：包含 `#任务` 标记的内容

| 元素 | 格式 | 说明 |
|------|------|------|
| 任务标记 | `#任务` | 标识这是任务行 |
| 层级 | `@L1/@L2/@L3` | L1 一级任务，L2/L3 子任务 |
| 任务链接 | `[链接名称](URL)` | 关联文档或外部链接（单独一行） |

> ⚠️ 注意：任务本身不挂时间，时间都放在事项上

#### 3. 事项区
位置：任务下方的内容（包含 `@` 但不含 `#任务`）

| 元素 | 格式 | 说明 |
|------|------|------|
| 工作事项 | 任意文本 + `@日期` | 事项内容 |
| 日期 | `@YYYY-MM-DD` | 事项日期 |
| 时间范围 | `@YYYY-MM-DD HH:mm~HH:mm` | 事项时间范围 |

### 标记说明

| 标记 | 说明 | 示例 |
|------|------|------|
| `##` | 项目名称 | `## 订单系统开发` |
| `>` | 项目描述 | `> 优化下单流程，提升转化率` |
| `#任务` | 标识为任务行 | `开发登录模块 #任务` |
| `@L1/@L2/@L3` | 任务层级 | `@L1` 一级任务，`@L2` 子任务 |
| `@YYYY-MM-DD` | 日期标记 | `@2026-02-25` |
| `@YYYY-MM-DD HH:mm:ss~HH:mm:ss` | 时间范围 | `@2026-02-25 14:00~16:00` |
| `[名称](URL)` | 链接 | `[需求文档](siyuan://blocks/202602...)` |

### 状态标签

事项可以通过标签标记状态，支持中英文：

| 状态 | 中文标签 | 英文标签 | 说明 |
|------|---------|---------|------|
| 待办 | 无（默认） | 无（默认） | 正常显示 |
| 已完成 | `#已完成` | `#done` | 显示删除线 |
| 已放弃 | `#已放弃` | `#abandoned` | 显示删除线 + 灰色 |

**自动识别**：解析时同时支持中英文标签，会根据系统语言自动选择打标语言。

#### 事项处理流程

```
当日事项（无标签）
    │
    ├─→ 完成 → 添加 #已完成（或 #done）
    │
    ├─→ 迁移 → 修改 @日期（明天或未来）
    │
    └─→ 放弃 → 添加 #已放弃（或 #abandoned）
```

#### 待办 Dock 显示

Dock 中展示四类事项：

1. **待办** - 今天及未来的未完成任务
2. **已完成** - 标记为已完成的事项
3. **已放弃** - 标记为放弃的事项
4. **已过期** - 时间过了但未完成的事项（红色标记）

### 完整示例

假设您有一个「电商订单系统」项目，文档内容如下：

```markdown
## 电商订单系统重构
> 优化下单流程，提升转化率 20%

[需求文档](https://example.com/requirements)
[研发甘特图](https://gantt.example.com/project123)

### 工作任务

用户登录模块开发 #任务 @L1
[登录模块设计](siyuan://blocks/20260220112000)

实现手机号登录 #任务 @L2
手机号登录开发 @2026-02-20

实现短信验证码 #任务 @L2
短信验证码开发 @2026-02-21

实现第三方登录（微信/Google）#任务 @L2
第三方登录开发 @2026-02-22

登录模块测试 @2026-02-23

购物车优化 #任务 @L1
购物车需求评审 @2026-02-24
购物车单元测试 @2026-02-25 10:00:00~12:00:00

订单结算页面开发 #任务 @L1
选择收货地址 @2026-02-26
选择支付方式 @2026-02-26
订单确认 @2026-02-27
```

解析后，您将看到：

- **日历视图**：显示每个任务的日期，支持日/周/月视图
- **甘特图**：展示任务的层级关系和时间跨度
- **项目列表**：按项目分组，显示所有任务和事项

![功能演示图](./asset/action.png)
<!-- 配图占位：请将功能演示截图替换到此处 -->

### 配置午休时间

在插件设置中，您可以配置午休时间（默认 12:00-13:00），用于计算工作时长时扣除午休时间。这会影响甘特图中任务的工作时长显示。

### 项目分组

1. 在设置中创建分组（如「前端项目」「后端项目」）
2. 为每个目录分配分组
3. 在视图中可以按分组筛选项目

## 安装

### 从集市安装（推荐）

1. 打开思源笔记 → 设置 → 插件 → 集市
2. 搜索「子弹笔记」
3. 点击安装

### 手动安装

1. 从 GitHub Release 下载 `package.zip`
2. 解压到思源数据目录 `data/plugins/siyuan-plugin-bullet-journal`
3. 在设置中启用插件

## 开发

```bash
# 安装依赖
npm install

# 开发模式（监听文件变化自动构建）
npm run dev

# 构建生产版本
npm run build

# 发布新版本
npm run release
```

## 项目结构

```
src/
├── index.ts              # 插件入口，定义 Tab、Dock、设置面板
├── main.ts               # 初始化逻辑
├── api.ts                # 思源 API 封装
├── parser/               # 解析器
│   ├── lineParser.ts     # 单行任务解析
│   └── markdownParser.ts # Kramdown 文档解析
├── stores/               # Pinia 状态管理
│   ├── projectStore.ts   # 项目数据状态
│   └── settingsStore.ts  # 设置状态
├── tabs/                 # 三个主要视图
│   ├── CalendarTab.vue   # 日历视图（基于 FullCalendar）
│   ├── GanttTab.vue      # 甘特图（基于 dhtmlx-gantt）
│   └── ProjectTab.vue    # 项目列表视图
├── components/           # 可复用组件
│   ├── SiyuanTheme/      # 思源风格的 UI 组件
│   ├── calendar/         # 日历相关组件
│   ├── gantt/           # 甘特图相关组件
│   └── project/         # 项目列表组件
└── utils/                # 工具函数
    ├── dateUtils.ts      # 日期处理
    └── dataConverter.ts  # 数据格式转换
```

## 技术栈

- **Vue 3** + **TypeScript** - 前端框架
- **Pinia** - 状态管理
- **FullCalendar** - 日历组件
- **dhtmlx-gantt** - 甘特图组件
- **Sass** - 样式预处理

## 致谢

本项目从 [obsidian-hk-work-plugin](https://github.com/MoonBottle/obsidian-hk-work-plugin) 移植而来。

使用了以下开源项目：

- [FullCalendar](https://fullcalendar.io/) - 日历组件
- [dhtmlxGantt](https://dhtmlx.com/docs/products/dhtmlxGantt/) - 甘特图组件

## 许可证

MIT
